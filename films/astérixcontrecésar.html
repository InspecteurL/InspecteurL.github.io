<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ast√©rix & Ob√©lix contre C√©sar  - BNZ</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<style>
/* --- Styles g√©n√©raux --- */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url('https://media.themoviedb.org/t/p/w1066_and_h600_bestv2/2gaZoIp1h8tSBNKARaSjzTVaC23.jpg') no-repeat center center fixed;
  background-size: cover;
  color: #fff;
  position: relative;
  z-index: 0;
}

/* Overlay sombre */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6); /* üëà r√®gle l‚Äôopacit√© (0.6 = 60%) */
  z-index: -1; /* reste derri√®re le contenu */
}

ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #1c1c1c;
}

li {
  float: left;
}

li a {
  display: block;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 20px;
}

li a:hover {
  background-color: red;
  border-radius: 5px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* --- Fiche du film --- */
.fiche {
  display: flex;
  flex-direction: row;
  gap: 20px;
  margin-bottom: 40px;
}
.fiche img {
  width: 300px;
  border-radius: 10px;
}
.fiche-info {
  flex: 1;
}
.fiche-info h1 {
  margin-top: 0;
}
.fiche-info p {
  line-height: 1.5;
}
/* Styles du bouton */
.btn-watch {
  display: inline-flex;
  align-items: center;
  gap: 8px; /* espace entre l'ic√¥ne et le texte */
  padding: 10px 20px;
  background-color: #ff3d00;
  color: white;
  font-size: 16px;
  font-weight: 500;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
}

.btn-watch:hover {
  background-color: #ff5722;
}

.btn-watch:hover .material-symbols-outlined {
  transform: scale(1.2); /* l'ic√¥ne grossit l√©g√®rement au survol */
}

/* --- Conteneur du lecteur --- */
.video-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: black;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
video {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

/* --- Bouton retour --- */
.back-button {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: opacity 0.3s;
  z-index: 1100;
}
.back-button:hover {
  background: rgba(255, 65, 108, 0.8);
}

/* --- Barre de progression et contr√¥les --- */
.progress-wrapper {
  position: absolute;
  bottom: 70px;
  left: 20px;
  right: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: white;
  font-size: 14px;
  font-family: monospace;
}
.progress {
  flex: 1;
  height: 12px;
  background: rgba(255,255,255,0.2);
  border-radius: 6px;
  overflow: hidden;
  cursor: pointer;
}
.progress-bar {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, #ff4b2b, #ff416c);
  border-radius: 6px;
}
.controls {
  position: absolute;
  bottom: 10px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: rgba(0,0,0,0.5);
  border-radius: 10px;
  opacity: 1;
  transition: opacity 0.3s;
}
.controls-left, .controls-right {
  display: flex;
  align-items: center;
  gap: 20px;
}
.center-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 80px;
  color: white;
  background: rgba(0,0,0,0.5);
  border-radius: 50%;
  padding: 20px;
  cursor: pointer;
  transition: opacity 0.3s;
}
.center-play.hide {
  opacity: 0;
  pointer-events: none;
}
.material-symbols-outlined {
  cursor: pointer;
  color: white;
  font-size: 35px;
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 35;
}
.volume-container {
  display: flex;
  align-items: center;
  gap: 10px;
}
#volume-slider {
  width: 100px;
  height: 5px;
  appearance: none;
  background: rgba(255,255,255,0.3);
  border-radius: 5px;
  outline: none;
  cursor: pointer;
}
#volume-slider::-webkit-slider-thumb {
  appearance: none;
  width: 12px;
  height: 12px;
  background: #ff416c;
  border-radius: 50%;
  cursor: pointer;
}
#volume-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  background: #ff416c;
  border-radius: 50%;
  cursor: pointer;
}
.menu {
  position: absolute;
  bottom: 60px;
  right: 20px;
  background: rgba(0,0,0,0.8);
  padding: 10px;
  border-radius: 8px;
  display: none;
  flex-direction: column;
  gap: 5px;
}
.menu button {
  background: transparent;
  border: none;
  color: white;
  padding: 5px 10px;
  cursor: pointer;
  text-align: left;
}
.menu button:hover {
  background: rgba(255,255,255,0.2);
}

/* --- Disparition automatique --- */
.hide {
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
  transition: opacity 0.4s ease;
}
.controls,
.progress-wrapper,
#centerPlay,
.back-button {
  opacity: 1;
  visibility: visible;
  transition: opacity 0.4s ease;
}
#navbar {
  display: block; /* visible par d√©faut */
}

/* --- RESPONSIVE --- */

/* Navbar responsive */
@media (max-width: 768px) {
  ul {
    display: flex;
    flex-direction: column;
    text-align: center;
  }

  li {
    float: none;
    width: 100%;
  }

  li a {
    font-size: 18px;
    padding: 12px;
  }
}

/* Fiche film responsive */
@media (max-width: 992px) {
  .fiche {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .fiche img {
    width: 80%;
    max-width: 250px;
  }

  .fiche-info {
    width: 100%;
  }

  .fiche-info h1 {
    font-size: 1.6rem;
  }
}

/* Petit √©cran (smartphones) */
@media (max-width: 600px) {
  .container {
    padding: 10px;
  }

  .btn-watch {
    width: 100%;
    justify-content: center;
    font-size: 14px;
    padding: 12px;
  }

  /* Contr√¥les vid√©o */
  .controls {
    flex-direction: column;
    gap: 10px;
    padding: 8px;
  }

  .controls-left, .controls-right {
    gap: 10px;
    justify-content: center;
  }

  .material-symbols-outlined {
    font-size: 28px;
  }

  .center-play {
    font-size: 60px;
    padding: 15px;
  }

  .progress-wrapper {
    bottom: 90px;
    flex-direction: column;
    align-items: center;
    font-size: 12px;
  }

  .progress {
    width: 100%;
    height: 8px;
  }

  .volume-container {
    width: 100%;
    justify-content: center;
  }

  #volume-slider {
    width: 80px;
  }

  /* Bouton retour */
  .back-button {
    font-size: 14px;
    padding: 8px 15px;
  }
}

/* Ultra petit √©cran (moins de 400px) */
@media (max-width: 400px) {
  .fiche img {
    width: 100%;
    max-width: 200px;
  }

  .fiche-info h1 {
    font-size: 1.3rem;
  }

  .btn-watch {
    font-size: 12px;
    padding: 10px;
  }

  .material-symbols-outlined {
    font-size: 24px;
  }

  .center-play {
    font-size: 50px;
    padding: 12px;
  }
}
</style>



</head>
<body>
 <ul id="navbar">
  <li><a class="active" href="https://inspecteurl.github.io/site/index.html">Home</a></li>
  <li><a href="https://inspecteurl.github.io/site/compte.html">Votre Compte</a></li>
  <li><a href="https://inspecteurl.github.io/site/mes-amis.html">Mes amis</a></li>
  <li><a href="https://inspecteurl.github.io/site/accueil.html">Feuilleter</a></li>
</ul>

<!-- --- Fiche du film --- -->
<div class="container">
  <div class="fiche">
    <img src="https://media.themoviedb.org/t/p/w440_and_h660_face/2xFo4wO4zAGb3KcyvBsC2igLLdF.jpg" alt="Interstellar Poster">
    <div class="fiche-info">
      <h1>Ast√©rix & Ob√©lix contre C√©sar (1999)</h1>
      <p><strong>Genre:</strong> Familial, Fantastique, Com√©die, Aventure</p>
      <p><strong>R√©alisateur:</strong> Claude Zidi</p>
      <p><strong>Acteurs:</strong> Christian Clavier, G√©rard Depardieu, Roberto Benigni</p>
      <p><strong>Synopsis:</strong> La Gaule en l'an 50 avant J√©sus-Christ, est occup√©e par les Romains. Un seul village r√©siste, gr√¢ce √† la potion magique, pr√©par√©e par le druide Panoramix, qui rend ses habitants invincibles pendant plusieurs minutes. Parmi eux, nos h√©ros Ast√©rix et Ob√©lix, ridiculisent n'importe quel assaillant. Au moment o√π C√©sar se pr√©pare √† envahir l'Angleterre, il apprend que ce village tient en √©chec ses troupes et refuse de payer l'imp√¥t.</p>
   <button class="btn-watch" id="btnWatch">
  <span class="material-symbols-outlined">play_arrow</span>
  Lire le film
</button>

    </div>
  </div>
</div>

<!-- --- Lecteur vid√©o --- -->
<div class="video-container" id="videoContainer">
  <button class="back-button" id="backButton">‚Üê Retour √† la fiche</button>
  <video id="video" src="https://cinetacos.xyz/movies/Asterix---Obelix-contre-Cesar.mp4"></video>
  <span id="centerPlay" class="material-symbols-outlined center-play">play_arrow</span>

  <div class="progress-wrapper" id="progressWrapper">
    <span id="currentTime">0:00</span>
    <div class="progress" id="progress">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <span id="totalTime">0:00</span>
  </div>

  <div class="controls" id="controls">
    <div class="controls-left">
      <span id="backward" class="material-symbols-outlined">replay_10</span>
      <span id="play" class="material-symbols-outlined">play_arrow</span>
      <span id="forward" class="material-symbols-outlined">forward_10</span>
      <div class="volume-container">
        <span id="volume-icon" class="material-symbols-outlined">volume_up</span>
        <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1">
      </div>
    </div>
    <div class="controls-right">
      <span id="subtitles" class="material-symbols-outlined">subtitles</span>
      <span id="source" class="material-symbols-outlined">cloud</span>
      <span id="settings" class="material-symbols-outlined">settings</span>
      <span id="fullscreen" class="material-symbols-outlined">fullscreen</span>
    </div>
  </div>

  <div id="settingsMenu" class="menu">
    <button data-speed="0.5">0.5x</button>
    <button data-speed="1">1x</button>
    <button data-speed="1.5">1.5x</button>
    <button data-speed="2">2x</button>
  </div>

  <div id="sourceMenu" class="menu">
    <button data-src="https://cinepizza.xyz/movies/Interstellar.mp4">Interstellar</button>
  </div>

  <div id="subtitleMenu" class="menu">
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.8.0/+esm";

const supabase = createClient(
  "https://wuagahavmbugmnuzsouf.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1YWdhaGF2bWJ1Z21udXpzb3VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2MDM2NTksImV4cCI6MjA2ODE3OTY1OX0.mjf9cUleV_oq8TsWeKvPVOJSGPc98AyGyfJeA-Tpvho"
);

document.addEventListener('DOMContentLoaded', async () => {
  // --- R√©cup√©ration s√©curis√©e des √©l√©ments DOM (v√©rifie leur pr√©sence) ---
  const ids = [
    'video','videoContainer','controls','progressWrapper','progress','progress-bar',
    'currentTime','totalTime','play','centerPlay','volume-slider','volume-icon',
    'settings','settingsMenu','source','sourceMenu','subtitles','subtitleMenu',
    'btnWatch','backButton','navbar','fullscreen','backward','forward'
  ];
  const E = {};
  for (const id of ids) {
    E[id] = document.getElementById(id);
    if (!E[id]) console.warn(`Element manquant: #${id} ‚Äî v√©rifie ton HTML`);
  }

  // Si le plus essentiel manque, on arr√™te (√©vite erreurs JS en cascade)
  if (!E.video || !E.btnWatch || !E.backButton || !E.videoContainer) {
    console.error('√âl√©ments essentiels introuvables dans le DOM. Le script ne peut pas fonctionner.');
    return;
  }

  // --- Session Supabase (userId) ---
  let userId = null;
  async function fetchSessionUserId() {
    try {
      const { data, error } = await supabase.auth.getSession();
      if (error) {
        console.error('Erreur getSession Supabase:', error);
        return null;
      }
      const session = data?.session;
      if (!session) {
        console.info('Aucune session active ‚Äî l\'activit√© utilisateur ne sera pas mise √† jour.');
        return null;
      }
      return session.user?.id ?? null;
    } catch (err) {
      console.error('Erreur inattendue fetchSessionUserId:', err);
      return null;
    }
  }
  userId = await fetchSessionUserId();

  // --- Helpers Supabase pour activity sur profiles ---
  async function startWatching() {
    if (!userId) {
      console.info('Utilisateur non connect√© ‚Üí skip startWatching()');
      return;
    }
    const updates = {
      currently_watching: "Ast√©rix & Ob√©lix contre C√©sar",
      watching_type: "film",
      episode_number: null,
      current_season: null,
      episode_image: "https://media.themoviedb.org/t/p/w440_and_h660_face/2xFo4wO4zAGb3KcyvBsC2igLLdF.jpg"
    };
    try {
      const { data, error } = await supabase.from('profiles').update(updates).eq('id', userId);
      if (error) {
        console.error('Supabase startWatching update error:', error);
      } else {
        console.info('startWatching: profile mis √† jour', data);
      }
    } catch (err) {
      console.error('Erreur startWatching:', err);
    }
  }

  async function stopWatching() {
    if (!userId) {
      console.info('Utilisateur non connect√© ‚Üí skip stopWatching()');
      return;
    }
    const updates = {
      currently_watching: null,
      watching_type: null,
      episode_number: null,
      current_season: null,
      episode_image: null
    };
    try {
      const { data, error } = await supabase.from('profiles').update(updates).eq('id', userId);
      if (error) {
        console.error('Supabase stopWatching update error:', error);
      } else {
        console.info('stopWatching: profile nettoy√©', data);
      }
    } catch (err) {
      console.error('Erreur stopWatching:', err);
    }
  }

  // --- Contr√¥les vid√©o & UI ---
  const video = E.video;
  let hideTimeout;
  video.controls = false;

  function showControls() {
    if (E.controls) E.controls.classList.remove('hide');
    if (E.progressWrapper) E.progressWrapper.classList.remove('hide');
    if (E.centerPlay) E.centerPlay.classList.remove('hide');
    if (E.backButton) E.backButton.classList.remove('hide');
    document.body.style.cursor = 'default';
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideControls, 3000);
  }
  function hideControls() {
    if (!video.paused && E.centerPlay) E.centerPlay.classList.add('hide');
    if (E.controls) E.controls.classList.add('hide');
    if (E.progressWrapper) E.progressWrapper.classList.add('hide');
    if (E.backButton) E.backButton.classList.add('hide');
    document.body.style.cursor = 'none';
    [E.settingsMenu, E.sourceMenu, E.subtitleMenu].forEach(m => { if(m) m.style.display = 'none'; });
  }
  document.addEventListener('mousemove', showControls);
  document.addEventListener('keydown', showControls);
  video.addEventListener('click', showControls);

  // play/pause helper
  function togglePlay() { if (video.paused) video.play(); else video.pause(); }
  if (E.play) E.play.addEventListener('click', togglePlay);
  if (E.centerPlay) E.centerPlay.addEventListener('click', togglePlay);

  // loadedmetadata ‚Üí affiche dur√©e totale
  video.addEventListener('loadedmetadata', () => {
    if (E.totalTime) E.totalTime.textContent = formatTime(video.duration);
  });

  // timeupdate ‚Üí mise √† jour progress & time
  video.addEventListener('timeupdate', () => {
    if (E.progressBar) {
      const percent = (video.currentTime / (video.duration || 1)) * 100;
      E.progressBar.style.width = `${percent}%`;
    }
    if (E.currentTime) E.currentTime.textContent = formatTime(video.currentTime);
    if (E.totalTime && !isNaN(video.duration)) E.totalTime.textContent = formatTime(video.duration);
  });

  // error event pour la vid√©o (DNS / CORS / 404)
  video.addEventListener('error', (ev) => {
    console.error('Erreur lecture vid√©o:', ev, video.error);
    // montre une alerte simple √† l'utilisateur (optionnel)
    // alert('Impossible de charger la vid√©o ‚Äî v√©rifie l\'URL ou la connexion serveur.');
  });

  // progress seek
  if (E.progressWrapper && E.progress) {
    E.progressWrapper.addEventListener('click', (e) => {
      const rect = E.progress.getBoundingClientRect();
      const pos = (e.clientX - rect.left) / rect.width;
      if (!isNaN(video.duration)) video.currentTime = pos * video.duration;
    });
  }

  // volume
  if (E['volume-slider']) {
    E['volume-slider'].addEventListener('input', () => { video.volume = E['volume-slider'].value; updateVolumeIcon(); });
  }
  if (E['volume-icon']) {
    E['volume-icon'].addEventListener('click', () => {
      if (video.volume > 0) { video.volume = 0; if(E['volume-slider']) E['volume-slider'].value = 0; }
      else { video.volume = 1; if(E['volume-slider']) E['volume-slider'].value = 1; }
      updateVolumeIcon();
    });
  }
  function updateVolumeIcon() {
    if (!E['volume-icon']) return;
    if (video.volume === 0) E['volume-icon'].textContent = 'volume_off';
    else if (video.volume < 0.5) E['volume-icon'].textContent = 'volume_down';
    else E['volume-icon'].textContent = 'volume_up';
  }

  // settings menu
  if (E.settings) E.settings.addEventListener('click', () => toggleMenu(E.settingsMenu));
  if (E.settingsMenu) E.settingsMenu.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      video.playbackRate = parseFloat(btn.dataset.speed);
      E.settingsMenu.style.display = 'none';
    });
  });

  // source menu
  if (E.source) E.source.addEventListener('click', () => toggleMenu(E.sourceMenu));
  if (E.sourceMenu) E.sourceMenu.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      video.src = btn.dataset.src;
      video.play();
      E.sourceMenu.style.display = 'none';
    });
  });

  // subtitles menu
  if (E.subtitles) E.subtitles.addEventListener('click', () => toggleMenu(E.subtitleMenu));
  if (E.subtitleMenu) E.subtitleMenu.addEventListener('click', (ev) => {
    if (ev.target.tagName === 'BUTTON') {
      const subUrl = ev.target.dataset.sub;
      video.querySelectorAll('track').forEach(t => t.remove());
      if (subUrl) {
        const track = document.createElement('track');
        track.src = subUrl;
        track.kind = 'subtitles';
        track.default = true;
        video.appendChild(track);
      }
      E.subtitleMenu.style.display = 'none';
    }
  });

  // fullscreen
  if (E.fullscreen) E.fullscreen.addEventListener('click', () => {
    if (!document.fullscreenElement) E.videoContainer.requestFullscreen();
    else document.exitFullscreen();
  });

  // backward/forward
  if (E.backward) E.backward.addEventListener('click', () => video.currentTime = Math.max(0, video.currentTime - 10));
  if (E.forward) E.forward.addEventListener('click', () => video.currentTime = Math.min(video.duration || Infinity, video.currentTime + 10));

  // --- btnWatch / backButton => Supabase activity update
  E.btnWatch.addEventListener('click', async () => {
    E.videoContainer.style.display = 'flex';
    try { await video.play().catch(()=>{}); } catch(e) {}
    if (E.navbar) E.navbar.style.display = 'none';
    showControls();
    await startWatching(); // loggue erreurs si besoin
  });

  E.backButton.addEventListener('click', async () => {
    video.pause();
    video.currentTime = 0;
    E.videoContainer.style.display = 'none';
    if (document.fullscreenElement) document.exitFullscreen();
    if (E.navbar) E.navbar.style.display = 'block';
    await stopWatching();
  });

  // ---------- util ----------
  function toggleMenu(menu) {
    [E.settingsMenu, E.sourceMenu, E.subtitleMenu].forEach(m => { if (m && m !== menu) m.style.display = 'none'; });
    if (!menu) return;
    menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
  }
  function formatTime(sec) {
    if (!sec || isNaN(sec)) return '0:00';
    const m = Math.floor(sec / 60);
    const s = Math.floor(sec % 60);
    return `${m}:${s.toString().padStart(2,'0')}`;
  }

  // debug helper
  console.info('Script initialis√© ‚Äî √©l√©ments pr√©sents:', Object.keys(E).filter(k => !!E[k]));
});
</script>


</body>
</html>
