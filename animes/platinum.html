<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<title>Platinum End - BNZ</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>


<style>
/* --- Styles globaux --- */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url('https://media.themoviedb.org/t/p/w1066_and_h600_bestv2/cAHEOyPIhVv7vCGxQ13OP3XdBYJ.jpg') no-repeat center center fixed;
  background-size: cover;
  color: #fff;
  position: relative;
  z-index: 0;
}

/* Overlay sombre */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: -1;
}

/* --- Navbar --- */
ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #1c1c1c;
}

li {
  float: left;
}

li a {
  display: block;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 20px;
}

li a:hover {
  background-color: red;
  border-radius: 5px;
}

/* Navbar responsive */
#navbar {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
}

/* --- Conteneur des cartes --- */
.cards-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin: 20px 0;
  padding: 0 20px;
  box-sizing: border-box;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}

/* Cartes individuelles */
.card {
  flex: 1 1 calc(20% - 20px);
  max-width: 220px;
  background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
  border-radius: 15px;
  overflow: hidden;
  text-align: center;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  transition: transform 0.3s ease;
  border-bottom: 2px solid #333;
}

.card:hover img {
  transform: scale(1.05);
}

.card h3 {
  margin: 10px 0;
  font-size: 18px;
  font-weight: 700;
  color: #ff416c;
  text-shadow: 1px 1px 3px #000;
}

.card:hover {
  transform: scale(1.08);
  box-shadow: 0 10px 25px rgba(255,65,108,0.5);
}

/* --- Sélecteur de saison --- */
.season-selector {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 20px 0;
}

.season-selector button {
  background: linear-gradient(90deg, #ff416c, #ff4b2b);
  border: none;
  color: white;
  font-weight: 600;
  padding: 10px 20px;
  border-radius: 25px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.season-selector button:hover {
  transform: scale(1.1);
  box-shadow: 0 5px 15px rgba(255,65,108,0.6);
}

.season-selector button.active {
  box-shadow: 0 0 15px rgba(255,65,108,0.8);
}

/* --- Fiche du film --- */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.fiche {
  display: flex;
  flex-direction: row;
  gap: 20px;
  margin-bottom: 40px;
}

.fiche img {
  width: 300px;
  border-radius: 10px;
}

.fiche-info {
  flex: 1;
}

.fiche-info h1 {
  margin-top: 0;
}

.fiche-info p {
  line-height: 1.5;
}

/* --- Bouton regarder --- */
.btn-watch {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background-color: #ff3d00;
  color: white;
  font-size: 16px;
  font-weight: 500;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
}

.btn-watch:hover {
  background-color: #ff5722;
}

.btn-watch:hover .material-symbols-outlined {
  transform: scale(1.2);
}

/* --- Conteneur du lecteur vidéo --- */
.video-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: black;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

video {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

/* --- Bouton retour --- */
.back-button {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: opacity 0.3s;
  z-index: 1100;
}

.back-button:hover {
  background: rgba(255, 65, 108, 0.8);
}

/* --- Barre de progression et contrôles --- */
.progress-wrapper {
  position: absolute;
  bottom: 70px;
  left: 20px;
  right: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: white;
  font-size: 14px;
  font-family: monospace;
}

.progress {
  flex: 1;
  height: 12px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  overflow: hidden;
  cursor: pointer;
}

.progress-bar {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, #ff4b2b, #ff416c);
  border-radius: 6px;
}

.controls {
  position: absolute;
  bottom: 10px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 10px;
  opacity: 1;
  transition: opacity 0.3s;
}

.controls-left,
.controls-right {
  display: flex;
  align-items: center;
  gap: 20px;
}

.center-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 80px;
  color: white;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 50%;
  padding: 20px;
  cursor: pointer;
  transition: opacity 0.3s;
}

.center-play.hide {
  opacity: 0;
  pointer-events: none;
}

.material-symbols-outlined {
  cursor: pointer;
  color: white;
  font-size: 35px;
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 35;
}

/* Volume */
.volume-container {
  display: flex;
  align-items: center;
  gap: 10px;
}

#volume-slider {
  width: 100px;
  height: 5px;
  appearance: none;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 5px;
  outline: none;
  cursor: pointer;
}

#volume-slider::-webkit-slider-thumb {
  appearance: none;
  width: 12px;
  height: 12px;
  background: #ff416c;
  border-radius: 50%;
  cursor: pointer;
}

#volume-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  background: #ff416c;
  border-radius: 50%;
  cursor: pointer;
}

/* Menu contextuel */
.menu {
  position: absolute;
  bottom: 60px;
  right: 20px;
  background: rgba(0, 0, 0, 0.8);
  padding: 10px;
  border-radius: 8px;
  display: none;
  flex-direction: column;
  gap: 5px;
}

.menu button {
  background: transparent;
  border: none;
  color: white;
  padding: 5px 10px;
  cursor: pointer;
  text-align: left;
}

.menu button:hover {
  background: rgba(255, 255, 255, 0.2);
}

.hide {
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
  transition: opacity 0.4s ease;
}

.controls,
.progress-wrapper,
#centerPlay,
.back-button {
  opacity: 1;
  visibility: visible;
  transition: opacity 0.4s ease;
}

/* --- Media Queries pour la responsivité --- */

/* Tablettes */
@media (max-width: 1024px) {
  .card {
    flex: 1 1 calc(33.333% - 20px);
    max-width: 200px;
  }

  .fiche {
    flex-direction: column;
    align-items: center;
  }

  .fiche img {
    width: 80%;
    max-width: 300px;
  }

  .fiche-info {
    text-align: center;
  }

  li {
    float: none;
    text-align: center;
  }

  li a {
    font-size: 18px;
  }
}

/* Mobiles */
@media (max-width: 768px) {
  .card {
    flex: 1 1 calc(50% - 20px);
    max-width: 180px;
  }

  .season-selector {
    flex-direction: column;
    gap: 10px;
  }

  .fiche img {
    width: 100%;
    max-width: 250px;
  }

  .fiche-info h1 {
    font-size: 22px;
  }

  .fiche-info p {
    font-size: 14px;
  }

  li a {
    padding: 10px 12px;
    font-size: 16px;
  }
}

/* Très petits écrans */
@media (max-width: 480px) {
  .card {
    flex: 1 1 100%;
    max-width: 100%;
  }

  .season-selector {
    gap: 8px;
  }

  .fiche-info h1 {
    font-size: 20px;
  }

  .fiche-info p {
    font-size: 13px;
  }
}



</style>
</head>
<body>
 <ul id="navbar">
  <li><a class="active" href="https://inspecteurl.github.io/site/index.html">Home</a></li>
  <li><a href="https://inspecteurl.github.io/site/compte.html">Votre Compte</a></li>
  <li><a href="https://inspecteurl.github.io/site/mes-amis.html">Mes amis</a></li>
  <li><a href="https://inspecteurl.github.io/site/accueil.html">Feuilleter</a></li>
</ul>

  <div class="container">
    <div class="fiche">
      <img src="https://media.themoviedb.org/t/p/w440_and_h660_face/rS17loSa3LM1HxO1MhGf5B3iCDS.jpg" alt="Interstellar Poster">
      <div class="fiche-info">
        <h1>Platinum End (2021)</h1>
        <p><strong>Genre:</strong> Animation, Drame, Mystère</p>
        <p><strong>Réalisateur:</strong> Signal.MD</p>
        <p><strong>Acteurs:</strong> Miyu Irino, Yui Ogura, Mao Ichimichi</p>
        <p><strong>Synopsis:</strong> Dieu se meurt. Selon la tradition, 13 Anges sont envoyés au Japon et doivent choisir chacun un humain qui recevra le pouvoir de vie et de mort sur les autres hommes pendant 999 jours. Au terme de ce délai, les actions des candidats au poste de Dieu seront jugées et l'un d'eux sera élu pour être le nouveau Dieu du Paradis.

Mirai Kakehashi est un lycéen qui n'espère plus rien de la vie ; ayant perdu ses parents très jeune et étant battu par son oncle et sa tante, la seule famille qui lui reste, il choisit de se suicider en sautant du toit d'un immeuble. Mais il est sauvé de justesse par Nasse, une Ange qui lui offre trois pouvoirs spéciaux et fait de lui l'un des 13 candidats au poste de Dieu.

Dorénavant, Mirai a la capacité de changer les gens qui l'entourent. Mais parviendra t-il à reprendre goût à la vie grâce à ces dons du ciel ?</p>
      </div>
    </div>
  </div>

  <!-- --- Lecteur vidéo --- -->
  <div class="video-container" id="videoContainer">
    <button class="back-button" id="backButton">← Retour à la fiche</button>
    <video id="video" src="https://cinepizza.xyz/movies/Interstellar.mp4"></video>
    <span id="centerPlay" class="material-symbols-outlined center-play">play_arrow</span>

    <div class="progress-wrapper" id="progressWrapper">
      <span id="currentTime">0:00</span>
      <div class="progress" id="progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <span id="totalTime">0:00</span>
    </div>

    <div class="controls" id="controls">
      <div class="controls-left">
        <span id="backward" class="material-symbols-outlined">replay_10</span>
        <span id="play" class="material-symbols-outlined">play_arrow</span>
        <span id="forward" class="material-symbols-outlined">forward_10</span>
        <div class="volume-container">
          <span id="volume-icon" class="material-symbols-outlined">volume_up</span>
          <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1">
        </div>
      </div>
      <div class="controls-right">
        <span id="subtitles" class="material-symbols-outlined">subtitles</span>
        <span id="source" class="material-symbols-outlined">cloud</span>
        <span id="settings" class="material-symbols-outlined">settings</span>
        <span id="fullscreen" class="material-symbols-outlined">fullscreen</span>
      </div>
    </div>

    <div id="settingsMenu" class="menu">
      <button data-speed="0.5">0.5x</button>
      <button data-speed="1">1x</button>
      <button data-speed="1.5">1.5x</button>
      <button data-speed="2">2x</button>
    </div>

    <div id="sourceMenu" class="menu">
      <button data-src="https://cinepizza.xyz/movies/Interstellar.mp4">Interstellar</button>
    </div>

    <div id="subtitleMenu" class="menu"></div>
  </div>

  <!-- Navbar transformée en cartes interactives (13 épisodes) -->
<!-- Sélecteur de saison -->
<div class="season-selector">
  <button class="active" data-season="1">Saison 1</button>
</div>

<!-- Cartes des épisodes -->
<div class="cards-container" id="season-episodes">
  <!-- Saison 1 -->
  <!-- Épisodes 1 à 37 -->
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E01.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/84rk6ZUXiQgozG5hSazNrr1eKap.jpg" alt="Épisode 1">
  <h3>Épisode 1</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E02.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/dNc0ywS0oPNOzMcgSaTjyBLQkMe.jpg" alt="Épisode 2">
  <h3>Épisode 2</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E03.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/euSmNCElVqwejRVZv0XGJqSVyMv.jpg" alt="Épisode 3">
  <h3>Épisode 3</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E04.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/kRD0F2y1opQUdukzLnI3bIgnNtO.jpg" alt="Épisode 4">
  <h3>Épisode 4</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E05.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/k1DvCCWkntuvImI4UQmVUK7V6Og.jpg" alt="Épisode 5">
  <h3>Épisode 5</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E06.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/iXh27pZNEaGm85nxNerArFCCO2U.jpg" alt="Épisode 6">
  <h3>Épisode 6</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E07.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/4rudkOn9woApCcXVUgmdfh7YE7Z.jpg" alt="Épisode 7">
  <h3>Épisode 7</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E08.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/iBlhwOfOWy3mjO3oLa6QaYYVwq9.jpg" alt="Épisode 8">
  <h3>Épisode 8</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E09.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/mckGkktyuc1FFO13vZ0BFA3a0sz.jpg" alt="Épisode 9">
  <h3>Épisode 9</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E10.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/meXDbu30sJFnNd8CFIhw7flTiMI.jpg" alt="Épisode 10">
  <h3>Épisode 10</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E11.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/hNHA5bSHsdBfujidUc19jitGXIF.jpg" alt="Épisode 11">
  <h3>Épisode 11</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E12.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/yasw5c7QkdeM7TCpGRgqv4vWoii.jpg" alt="Épisode 12">
  <h3>Épisode 12</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E13.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/eSV3n7CZk6DJH6Q36stkB5bjcu9.jpg" alt="Épisode 13">
  <h3>Épisode 13</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E14.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/qtvX5bb31PXJNvIxQrRWeFsVcTz.jpg" alt="Épisode 14">
  <h3>Épisode 14</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E15.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/rEU8FHP9FjHazGR5PgyMkth1TEH.jpg" alt="Épisode 15">
  <h3>Épisode 15</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E16.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/gI1pjwOxDeWyGBY6gnCbCNiDXZc.jpg" alt="Épisode 16">
  <h3>Épisode 16</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E17.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/zFMXvlwiFsW8hCzaRtJljO1SHv2.jpg" alt="Épisode 17">
  <h3>Épisode 17</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E18.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/wWrsUo6Uqee5w04D8xKwFngghbi.jpg" alt="Épisode 18">
  <h3>Épisode 18</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E19.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/5ZLAuEyvydz499MZQlgbZO30x7W.jpg" alt="Épisode 19">
  <h3>Épisode 19</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E20.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/1394LmR6eQkgLOVGmIaYFeI3Geu.jpg" alt="Épisode 20">
  <h3>Épisode 20</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E21.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/dIhe0wvwMCxmwbL4H8rOaNT5d63.jpg" alt="Épisode 21">
  <h3>Épisode 21</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E22.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/dcKMcyafMlE6y5iKxic7rnx8vBG.jpg" alt="Épisode 22">
  <h3>Épisode 22</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E23.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/9xwt1niOFiuXYv0L2JyBGMlDcg2.jpg" alt="Épisode 23">
  <h3>Épisode 23</h3>
</div>
<div class="card" data-season="1" data-video="https://cinecake.xyz/animes/VF/Platinum-End/S01/Platinum-End-S01-E24.mp4">
  <img src="https://media.themoviedb.org/t/p/w454_and_h254_bestv2/qtuEnXUe1jZ7QVxNA5rcAGQVCVw.jpg" alt="Épisode 24">
  <h3>Épisode 24</h3>
</div>









<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.8.0/+esm';

  // Initialisation Supabase
  const supabase = createClient(
    'https://wuagahavmbugmnuzsouf.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1YWdhaGF2bWJ1Z21udXpzb3VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2MDM2NTksImV4cCI6MjA2ODE3OTY1OX0.mjf9cUleV_oq8TsWeKvPVOJSGPc98AyGyfJeA-Tpvho'
  );

document.addEventListener('DOMContentLoaded', () => {
  const cards = document.querySelectorAll('.card');
  const videoContainer = document.getElementById('videoContainer');
  const video = document.getElementById('video');
  const backButton = document.getElementById('backButton');
  const centerPlay = document.getElementById('centerPlay');
  const controls = document.getElementById('controls');
  const progressWrapper = document.getElementById('progressWrapper');
  const progressBar = document.getElementById('progress-bar');
  const currentTimeEl = document.getElementById('currentTime');
  const totalTimeEl = document.getElementById('totalTime');
  const playBtn = document.getElementById('play');
  const volumeSlider = document.getElementById('volume-slider');
  const volumeIcon = document.getElementById('volume-icon');
  const settingsBtn = document.getElementById('settings');
  const settingsMenu = document.getElementById('settingsMenu');
  const sourceBtn = document.getElementById('source');
  const sourceMenu = document.getElementById('sourceMenu');
  const subtitleBtn = document.getElementById('subtitles');
  const subtitleMenu = document.getElementById('subtitleMenu');
  const forwardBtn = document.getElementById('forward');
  const backwardBtn = document.getElementById('backward');

  let hls;

  function openVideo() {
    videoContainer.style.display = 'flex';
    showControls();
  }

  function closeVideo() {
    video.pause();
    video.currentTime = 0;
    videoContainer.style.display = 'none';
    if(document.fullscreenElement) document.exitFullscreen();
    if(hls && hls.media) {
      hls.destroy();
      hls = null;
    }
  }

  backButton.addEventListener('click', closeVideo);

  function playMovie(src) {
    openVideo();

    if(hls && hls.media) {
      hls.destroy();
      hls = null;
    }

    if(src.endsWith('.m3u8')) {
      if(video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
        video.play().catch(err => console.warn(err));
      } else if(Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(src);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(err => console.warn(err));
        });
        hls.on(Hls.Events.ERROR, (event, data) => {
          console.error('HLS.js error', data);
        });
      } else {
        alert("Votre navigateur ne supporte pas HLS (.m3u8)");
      }
    } else {
      video.src = src;
      video.play().catch(err => console.warn(err));
    }
  }

  cards.forEach(card => {
    card.addEventListener('click', () => {
      const videoSrc = card.dataset.video;
      if(videoSrc) playMovie(videoSrc);
    });
  });

  function togglePlay() {
    if(video.paused) video.play();
    else video.pause();
  }

  playBtn.addEventListener('click', togglePlay);
  centerPlay.addEventListener('click', togglePlay);

  video.addEventListener('play', () => {
    playBtn.textContent = 'pause';
    centerPlay.textContent = 'pause';
    showControls();
  });

  video.addEventListener('pause', () => {
    playBtn.textContent = 'play_arrow';
    centerPlay.textContent = 'play_arrow';
    centerPlay.classList.remove('hide');
    showControls();
  });

  forwardBtn.addEventListener('click', () => {
    if (!isNaN(video.duration)) video.currentTime = Math.min(video.currentTime + 10, video.duration);
  });

  backwardBtn.addEventListener('click', () => {
    if (!isNaN(video.duration)) video.currentTime = Math.max(video.currentTime - 10, 0);
  });

  function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = Math.floor(sec % 60);
    return `${m}:${s.toString().padStart(2,'0')}`;
  }

  video.addEventListener('timeupdate', () => {
    if(!isNaN(video.duration) && video.duration > 0) {
      const percent = (video.currentTime / video.duration) * 100;
      progressBar.style.width = percent + '%';
      currentTimeEl.textContent = formatTime(video.currentTime);
      totalTimeEl.textContent = formatTime(video.duration);
    }
  });

  progressWrapper.addEventListener('click', e => {
    if(!isNaN(video.duration) && video.duration > 0) {
      const rect = progressWrapper.getBoundingClientRect();
      const pos = (e.clientX - rect.left) / rect.width;
      video.currentTime = pos * video.duration;
    }
  });

  volumeSlider.addEventListener('input', () => {
    video.volume = volumeSlider.value;
    updateVolumeIcon();
  });

  volumeIcon.addEventListener('click', () => {
    if(video.volume > 0) { video.volume = 0; volumeSlider.value = 0; }
    else { video.volume = 1; volumeSlider.value = 1; }
    updateVolumeIcon();
  });

  function updateVolumeIcon() {
    if(video.volume === 0) volumeIcon.textContent = 'volume_off';
    else if(video.volume < 0.5) volumeIcon.textContent = 'volume_down';
    else volumeIcon.textContent = 'volume_up';
  }

  settingsBtn.addEventListener('click', () => toggleMenu(settingsMenu));
  settingsMenu.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      video.playbackRate = parseFloat(btn.dataset.speed);
      settingsMenu.style.display = 'none';
    });
  });

  sourceBtn.addEventListener('click', () => toggleMenu(sourceMenu));
  subtitleBtn.addEventListener('click', () => toggleMenu(subtitleMenu));

  function toggleMenu(menu) {
    menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
  }

  document.getElementById('fullscreen').addEventListener('click', () => {
    if(!document.fullscreenElement) videoContainer.requestFullscreen();
    else document.exitFullscreen();
  });

  let hideTimeout;
  video.controls = false;

  function showControls() {
    controls.classList.remove('hide');
    progressWrapper.classList.remove('hide');
    centerPlay.classList.remove('hide');
    backButton.classList.remove('hide');
    document.body.style.cursor = 'default';
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideControls, 3000);
  }

  function hideControls() {
    if(!video.paused) centerPlay.classList.add('hide');
    controls.classList.add('hide');
    progressWrapper.classList.add('hide');
    backButton.classList.add('hide');
    document.body.style.cursor = 'none';
    [settingsMenu, sourceMenu, subtitleMenu].forEach(menu => menu.style.display = 'none');
  }

  document.addEventListener('mousemove', showControls);
  document.addEventListener('keydown', showControls);
  video.addEventListener('click', showControls);
  showControls();
});

     const seasonButtons = document.querySelectorAll('.season-selector button');
  const allCards = document.querySelectorAll('.cards-container .card');

  seasonButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      // active button
      seasonButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const season = btn.dataset.season;

      // afficher uniquement les cartes de la saison choisie
      allCards.forEach(card => {
        if (card.dataset.season === season) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // Afficher seulement la saison active au chargement
  window.addEventListener('DOMContentLoaded', () => {
    const activeSeason = document.querySelector('.season-selector button.active').dataset.season;
    allCards.forEach(card => {
      card.style.display = card.dataset.season === activeSeason ? 'block' : 'none';
    });
  });

/*************************************************
 * Activité Supabase (profiles table)
 *************************************************/
const ANIME_TITLE = "Arcane";
let currentSeason = 1;
let currentEpisodeIndex = null;
let userId = null;

/*************************************************
 * Session utilisateur
 *************************************************/
async function fetchSession() {
  const { data: sessionData, error } = await supabase.auth.getSession();
  if (error) {
    console.error("Erreur session Supabase:", error);
    return null;
  }
  const session = sessionData?.session;
  if (!session) {
    console.warn("Pas de session (non connecté).");
    return null;
  }
  return session.user.id;
}
(async () => {
  userId = await fetchSession();
})();

/*************************************************
 * Mise à jour activité
 *************************************************/
async function updateCurrentActivity(episodeCard) {
  if (!userId) return;

  // Récupère infos depuis la carte cliquée
  const episodeTitle = episodeCard.querySelector("h3")?.textContent || "";
  const episodeNumber = episodeTitle.match(/\d+/) ? parseInt(episodeTitle.match(/\d+/)[0], 10) : null;
  const episodeImage  = episodeCard.querySelector("img")?.src || null;

  const { error } = await supabase
    .from("profiles")
    .update({
      currently_watching: ANIME_TITLE,   // 🔑 juste le titre
      episode_number: episodeNumber,     // 🔑 numéro brut
      episode_image: episodeImage,
      current_season: currentSeason      // 🔑 numéro brut
    })
    .eq("id", userId);

  if (error) console.error("Erreur update activité:", error);
}

/*************************************************
 * Effacer activité
 *************************************************/
async function clearCurrentActivity() {
  if (!userId) return;
  const { error } = await supabase
    .from("profiles")
    .update({
      currently_watching: null,
      episode_number: null,
      episode_image: null,
      current_season: null
    })
    .eq("id", userId);

  if (error) console.error("Erreur clear activité:", error);
}

/*************************************************
 * Intégration avec ton lecteur
 *************************************************/
// Quand on clique sur une carte épisode → on lance la vidéo + update activité
document.querySelectorAll(".card").forEach((card, index) => {
  card.addEventListener("click", () => {
    currentSeason = card.dataset.season;
    currentEpisodeIndex = index;
    updateCurrentActivity(card);
  });
});

// Quand on ferme le lecteur vidéo → clear activité
document.getElementById("backButton").addEventListener("click", () => {
  clearCurrentActivity();
});


</script>

<script src="https://inspecteurl.github.io/films/script.js"></script>
</body>
</html>
